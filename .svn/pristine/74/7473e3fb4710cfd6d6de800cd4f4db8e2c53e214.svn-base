#Include "RwMake.ch"
#Include "Topconn.ch"
#Include "TbiConn.ch"
#Include "TbiCode.ch"
#INCLUDE "PROTHEUS.CH"                                                                                                                                        
#INCLUDE "ap5mail.ch"                                  

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммкмммммммяммммммммммммммммммммкммммммяммммммммммммм╩╠╠
╠╠╨Programa  ЁCABA113   ╨Autor  ЁMarcela Coimbra     ╨ Data Ё  08/06/16   ╨╠╠
╠╠лммммммммммьммммммммммймммммммоммммммммммммммммммммйммммммоммммммммммммм╧╠╠
╠╠╨Desc.     Ё Rotina de reajuste                                         ╨╠╠
╠╠╨          Ё                                                            ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                        ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/



User Function CABA113()  

Local c_Qry 	:= ""
Local c_AnoMes 	:= "201606"
Local c_MatFam 	:= ""
Local n_TotBPD  := 0
Local n_TotBPE  := 0
Local n_TotBPF  := 0       	
Local c_CodRea := ""
Local l_Opcional := .T. 
Local n_PerOpc := -16
Local l_AtuProd := .T.

//Prepare Environment Empresa "01" Filial "01"

c_CodRea := PLSA625Cd("BHW_CODREA","BHW",1,"BHW_CODINT","0001")
            
 
iF .t.
c_Qry += " SELECT   BA3_CODINT, "
c_Qry += " 			BA3_CODEMP, "
c_Qry += " 			BA3_CONEMP, "
c_Qry += " 			BA3_VERCON, "
c_Qry += " 			BA3_SUBCON, "
c_Qry += " 			BA3_VERSUB, "
c_Qry += " 			BA3_CODPLA, "
c_Qry += " 			BA3_MATRIC, "
c_Qry += " 			BBU_IDAINI, "
c_Qry += " 			BBU_CODFAI, "
c_Qry += " 			BBU_TIPUSR, "

c_Qry += " 			BBU_VALFAI, "
c_Qry += " 			BA3_FORPAG, "
c_Qry += " 			BA3_CONEMP, "
c_Qry += " 			BA3_VERCON, "
c_Qry += " 			BA3_SUBCON, "
c_Qry += " 			BA3_VERSUB, "
c_Qry += " 			BA3_CODPLA, "
c_Qry += " 			BA3_VERSAO, "

c_Qry += " 			BBU_IDAFIN, "
c_Qry += " 			BBU_VALFAI, "
c_Qry += " 			BBU_CODFOR, "
c_Qry += " 			BBU_CODFOR, "
c_Qry += " 			PCL_INDICE, "
c_Qry += " 			(case when PCL_PERCEN < 0 then Round( BBU_VALFAI - ((BBU_VALFAI * PCL_PERCEN * -1 ) / 100) ,2) else "
c_Qry += "                            Round( BBU_VALFAI + ((BBU_VALFAI * PCL_PERCEN  ) / 100) ,2)  end ) VAL_REA , "
c_Qry += " 			BBU.R_E_C_N_O_ RECBBU,  "
c_Qry += " 			BA3.R_E_C_N_O_ RECBA3,  "
c_Qry += " 			BBU.*, PCL_PERCEN      "

c_Qry += " FROM PCK010 INNER JOIN PCL010 PCL ON PCL_FILIAL = ' ' "
c_Qry += "              AND PCL_CODSEQ = PCK_CODSEQ     "

c_Qry += "              INNER JOIN BA3010 BA3 ON BA3_FILIAL = ' ' "
c_Qry += "              AND BA3_CODINT = '0001' "
c_Qry += "              AND BA3_CODEMP = PCL_EMPRES     "
c_Qry += "              AND BA3_CONEMP = DECODE(PCL_CONTRA, ' ', BA3_CONEMP, PCL_CONTRA)  "
c_Qry += "              AND BA3_VERCON = '001' "
c_Qry += "              AND BA3_SUBCON = DECODE(PCL_SUBCON, ' ', BA3_SUBCON, PCL_SUBCON) "
c_Qry += "              AND BA3_VERSUB = '001'               "
c_Qry += "              AND BA3_CODPLA = DECODE(PCL_SUBCON, ' ', BA3_CODPLA, PCL_PRODUT) "

c_Qry += "              INNER JOIN BBU010 BBU ON BBU_FILIAL = ' '  "
c_Qry += "              AND BBU_CODOPE = BA3_CODINT            "
c_Qry += "              AND BBU_CODEMP = BA3_CODEMP            "
c_Qry += "              AND BBU_MATRIC = BA3_MATRIC            "
c_Qry += "              AND BBU_TIPUSR = DECODE(PCL_TITULA, ' ', BBU_TIPUSR, PCL_TITULA) "

c_Qry += " WHERE PCL_CODSEQ = '000001' "
// c_Qry += " AND BA3_MATRIC = '000904' "
 c_Qry += " AND ( BA3_matric in (" 
 c_Qry += " '000011', "
 c_Qry += " '000069', "
 c_Qry += " '000108', "
 c_Qry += " '000120', "
 c_Qry += " '000127', "
 c_Qry += " '000147', "
 c_Qry += " '000155', "
 c_Qry += " '000167', "
 c_Qry += " '000210', "
 c_Qry += " '000267', "
 c_Qry += " '000298', "
 c_Qry += " '000362', "
 c_Qry += " '000378', "
 c_Qry += " '000420', "
 c_Qry += " '000455', "
 c_Qry += " '000467', "
 c_Qry += " '000489', "
 c_Qry += " '000526', "
 c_Qry += " '000540', "
 c_Qry += " '000558', "
 c_Qry += " '000793', "
 c_Qry += " '000911', "
 c_Qry += " '000915', "
 c_Qry += " '000955', "
 c_Qry += " '000971', "
 c_Qry += " '001037', "
 c_Qry += " '001044', "
 c_Qry += " '001080', "
 c_Qry += " '001166', "
 c_Qry += " '001182', "
 c_Qry += " '001186', "
 c_Qry += " '001194', "
 c_Qry += " '001272', "
 c_Qry += " '001274', "
 c_Qry += " '001301', "
 c_Qry += " '001394', "
 c_Qry += " '001475', "
 c_Qry += " '001482', "
 c_Qry += " '001483', "
 c_Qry += " '001494', "
 c_Qry += " '001511', "
 c_Qry += " '001530', "
 c_Qry += " '001538', "
 c_Qry += " '001588', "
 c_Qry += " '001636', "
 c_Qry += " '001647', "
 c_Qry += " '001668', "
 c_Qry += " '001689', "
 c_Qry += " '001733', "
 c_Qry += " '001734', "
 c_Qry += " '001821', "
 c_Qry += " '001850', "
 c_Qry += " '001870', "
 c_Qry += " '001875', "
 c_Qry += " '001883', "
 c_Qry += " '001919', "
 c_Qry += " '001931', "
 c_Qry += " '001941', "
 c_Qry += " '002023', "
 c_Qry += " '002033', "
 c_Qry += " '002050', "
 c_Qry += " '002051', "
 c_Qry += " '002154', "
 c_Qry += " '002172', "
 c_Qry += " '002201', "
 c_Qry += " '002209', "
 c_Qry += " '002249', "
 c_Qry += " '002251', "
 c_Qry += " '002264', "
 c_Qry += " '002329', "
 c_Qry += " '002331', "
 c_Qry += " '002401', "
 c_Qry += " '002415', "
 c_Qry += " '002436', "
 c_Qry += " '002443', "
 c_Qry += " '002449', "
 c_Qry += " '002485', "
 c_Qry += " '002518', "
 c_Qry += " '002552', "
 c_Qry += " '002560', "
 c_Qry += " '002568', "
 c_Qry += " '002576', "
 c_Qry += " '002711', "
 c_Qry += " '002721', "
 c_Qry += " '002754', "
 c_Qry += " '002769', "
 c_Qry += " '002803', "
 c_Qry += " '002824', "
 c_Qry += " '002852', "
 c_Qry += " '002928', "
 c_Qry += " '002931', "
 c_Qry += " '002935', "
 c_Qry += " '002956', "
 c_Qry += " '002959', "
 c_Qry += " '002980', "
 c_Qry += " '002987', "
 c_Qry += " '003111', "
 c_Qry += " '003141', "
 c_Qry += " '003215', "
 c_Qry += " '003226', "
 c_Qry += " '003241', "
 c_Qry += " '003262', "
 c_Qry += " '003267', "
 c_Qry += " '003303', "
 c_Qry += " '003304', "
 c_Qry += " '003325', "
 c_Qry += " '003419', "
 c_Qry += " '003420', "
 c_Qry += " '003455', "
 c_Qry += " '003530', "
 c_Qry += " '003548', "
 c_Qry += " '003563', "
 c_Qry += " '003569', "
 c_Qry += " '003599', "
 c_Qry += " '003603', "
 c_Qry += " '003639', "
 c_Qry += " '003656', "
 c_Qry += " '003658', "
 c_Qry += " '003767', "
 c_Qry += " '003796', "
 c_Qry += " '003817', "
 c_Qry += " '003825', "
 c_Qry += " '003832', "
 c_Qry += " '003834', "
 c_Qry += " '003845', "
 c_Qry += " '003889', "
 c_Qry += " '003905', "
 c_Qry += " '003930', "
 c_Qry += " '003933', "
 c_Qry += " '003946', "
 c_Qry += " '003947', "
 c_Qry += " '004039', "
 c_Qry += " '004083', "
 c_Qry += " '004117', "
 c_Qry += " '004133', "
 c_Qry += " '004205', "
 c_Qry += " '004210', "
 c_Qry += " '004212', "
 c_Qry += " '004276', "
 c_Qry += " '004327', "
 c_Qry += " '004342', "
 c_Qry += " '004404', "
 c_Qry += " '004491', "
 c_Qry += " '004511', "
 c_Qry += " '004517', "
 c_Qry += " '004519', "
 c_Qry += " '004664', "
 c_Qry += " '004669', "
 c_Qry += " '004698', "
 c_Qry += " '004759', "
 c_Qry += " '004769', "
 c_Qry += " '004772', "
 c_Qry += " '004779', "
 c_Qry += " '004863', "
 c_Qry += " '004870', "
 c_Qry += " '004942', "
 c_Qry += " '004946', "
 c_Qry += " '004977', "
 c_Qry += " '005046', "
 c_Qry += " '005116', "
 c_Qry += " '005119', "
 c_Qry += " '005160', "
 c_Qry += " '005217', "
 c_Qry += " '005241', "
 c_Qry += " '005328', "
 c_Qry += " '005340', "
 c_Qry += " '005355', "
 c_Qry += " '005422', "
 c_Qry += " '005438', "
 c_Qry += " '005443', "
 c_Qry += " '005454', "
 c_Qry += " '005578', "
 c_Qry += " '005597', "
 c_Qry += " '005607', "
 c_Qry += " '005616', "
 c_Qry += " '005668', "
 c_Qry += " '005779', "
 c_Qry += " '005788', "
 c_Qry += " '005823', "
 c_Qry += " '005825', "
 c_Qry += " '005929', "
 c_Qry += " '005945', "
 c_Qry += " '005961', "
 c_Qry += " '006031', "
 c_Qry += " '006184', "
 c_Qry += " '006194', "
 c_Qry += " '006222', "
 c_Qry += " '006340', "
 c_Qry += " '006353', "
 c_Qry += " '006439', "
 c_Qry += " '006454', "
 c_Qry += " '006522', "
 c_Qry += " '006552', "
 c_Qry += " '006563', "
 c_Qry += " '006662', "
 c_Qry += " '006670', "
 c_Qry += " '006695', "
 c_Qry += " '006696', "
 c_Qry += " '006701', "
 c_Qry += " '006720', "
 c_Qry += " '006781', "
 c_Qry += " '006809', "
 c_Qry += " '006853', "
 c_Qry += " '006869', "
 c_Qry += " '006907', "
 c_Qry += " '006932', "
 c_Qry += " '006985', "
 c_Qry += " '007120', "
 c_Qry += " '007146', "
 c_Qry += " '007244', "
 c_Qry += " '007253', "
 c_Qry += " '007254', "
 c_Qry += " '007383', "
 c_Qry += " '007435', "
 c_Qry += " '007452', "
 c_Qry += " '007481', "
 c_Qry += " '007503', "
 c_Qry += " '007530', "
 c_Qry += " '007549', "
 c_Qry += " '007640', "
 c_Qry += " '007660', "
 c_Qry += " '007663', "
 c_Qry += " '007765', "
 c_Qry += " '007767', "
 c_Qry += " '007814', "
 c_Qry += " '007881', "
 c_Qry += " '007884', "
 c_Qry += " '007972', "
 c_Qry += " '008038', "
 c_Qry += " '008080', "
 c_Qry += " '008123', "
 c_Qry += " '008126', "
 c_Qry += " '008166', "
 c_Qry += " '008208', "
 c_Qry += " '008264', "
 c_Qry += " '008384', "
 c_Qry += " '008414', "
 c_Qry += " '008441', "
 c_Qry += " '008461', "
 c_Qry += " '008478', "
 c_Qry += " '008531', "
 c_Qry += " '008580', "
 c_Qry += " '008605', "
 c_Qry += " '008607', "
 c_Qry += " '008614', "
 c_Qry += " '008663', "
 c_Qry += " '008686', "
 c_Qry += " '008687', "
 c_Qry += " '008834', "
 c_Qry += " '008878', "
 c_Qry += " '008979', "
 c_Qry += " '008986', "
 c_Qry += " '009083', "
 c_Qry += " '009135', "
 c_Qry += " '009213', "
 c_Qry += " '009247', "
 c_Qry += " '009255', "
 c_Qry += " '009403', "
 c_Qry += " '009408', "
 c_Qry += " '009488', "
 c_Qry += " '009507', "
 c_Qry += " '009557', "
 c_Qry += " '009690', "
 c_Qry += " '009751', "
 c_Qry += " '009761', "
 c_Qry += " '009789', "
 c_Qry += " '009897', "
 c_Qry += " '009899', "
 c_Qry += " '009935', "
 c_Qry += " '009936', "
 c_Qry += " '009964', "
 c_Qry += " '010004', "
 c_Qry += " '010032', "
 c_Qry += " '010072', "
 c_Qry += " '010189', "
 c_Qry += " '010242', "
 c_Qry += " '010249', "
 c_Qry += " '010264', "
 c_Qry += " '010274', "
 c_Qry += " '010331', "
 c_Qry += " '010336', "
 c_Qry += " '010347', "
 c_Qry += " '010360', "
 c_Qry += " '010394', "
 c_Qry += " '010395', "
 c_Qry += " '010421', "
 c_Qry += " '010434', "
 c_Qry += " '010437', "
 c_Qry += " '010473', "
 c_Qry += " '010485', "
 c_Qry += " '010487', "
 c_Qry += " '010527', "
 c_Qry += " '010541', "
 c_Qry += " '010554', "
 c_Qry += " '010575', "
 c_Qry += " '010586', "
 c_Qry += " '010601', "
 c_Qry += " '010647', "
 c_Qry += " '010658', "
 c_Qry += " '010782', "
 c_Qry += " '010811', "
 c_Qry += " '010841', "
 c_Qry += " '010885', "
 c_Qry += " '010944', "
 c_Qry += " '010947', "
 c_Qry += " '011009', "
 c_Qry += " '011100', "
 c_Qry += " '011125', "
 c_Qry += " '011127', "
 c_Qry += " '011177', "
 c_Qry += " '011180', "
 c_Qry += " '011224', "
 c_Qry += " '011258', "
 c_Qry += " '011275', "
 c_Qry += " '011393', "
 c_Qry += " '011404', "
 c_Qry += " '011424', "
 c_Qry += " '011604', "
 c_Qry += " '011732', "
 c_Qry += " '011733', "
 c_Qry += " '011776', "
 c_Qry += " '011778', "
 c_Qry += " '011895', "
 c_Qry += " '011923', "
 c_Qry += " '011951', "
 c_Qry += " '011955', "
 c_Qry += " '011960', "
 c_Qry += " '011974', "
 c_Qry += " '012039', "
 c_Qry += " '012043', "
 c_Qry += " '012140', "
 c_Qry += " '012195', "
 c_Qry += " '012245', "
 c_Qry += " '012255', "
 c_Qry += " '012265', "
 c_Qry += " '012310', "
 c_Qry += " '012348', "
 c_Qry += " '012369', "
 c_Qry += " '012381', "
 c_Qry += " '012435', "
 c_Qry += " '012567', "
 c_Qry += " '012586', "
 c_Qry += " '012669', "
 c_Qry += " '012676', "
 c_Qry += " '012721', "
 c_Qry += " '012749', "
 c_Qry += " '012834', "
 c_Qry += " '012853', "
 c_Qry += " '012868', "
 c_Qry += " '012909', "
 c_Qry += " '012924', "
 c_Qry += " '012947', "
 c_Qry += " '012948', "
 c_Qry += " '012974', "
 c_Qry += " '012982', "
 c_Qry += " '012997', "
 c_Qry += " '013010', "
 c_Qry += " '013026', "
 c_Qry += " '013055', "
 c_Qry += " '013094', "
 c_Qry += " '013104', "
 c_Qry += " '013119', "
 c_Qry += " '013127', "
 c_Qry += " '013166', "
 c_Qry += " '013222', "
 c_Qry += " '013226', "
 c_Qry += " '013253', "
 c_Qry += " '013261', "
 c_Qry += " '013330', "
 c_Qry += " '013371', "
 c_Qry += " '013383', "
 c_Qry += " '013405', "
 c_Qry += " '013450', "
 c_Qry += " '013511', "
 c_Qry += " '013583', "
 c_Qry += " '013619', "
 c_Qry += " '013649', "
 c_Qry += " '013699', "
 c_Qry += " '013703', "
 c_Qry += " '013720', "
 c_Qry += " '013782', "
 c_Qry += " '013813', "
 c_Qry += " '013914', "
 c_Qry += " '013927', "
 c_Qry += " '013942', "
 c_Qry += " '013950', "
 c_Qry += " '013959', "
 c_Qry += " '013961', "
 c_Qry += " '013982', "
 c_Qry += " '014009', "
 c_Qry += " '014079', "
 c_Qry += " '014110', "
 c_Qry += " '014131', "
 c_Qry += " '014174', "
 c_Qry += " '014186', "
 c_Qry += " '014254', "
 c_Qry += " '014266', "
 c_Qry += " '014267', "
 c_Qry += " '014342', "
 c_Qry += " '014353', "
 c_Qry += " '014356', "
 c_Qry += " '014366', "
 c_Qry += " '014453', "
 c_Qry += " '014469', "
 c_Qry += " '014596', "
 c_Qry += " '014598', "
 c_Qry += " '014663', "
 c_Qry += " '014708', "
 c_Qry += " '014722', "
 c_Qry += " '014736', "
 c_Qry += " '014779', "
 c_Qry += " '014817', "
 c_Qry += " '014868', "
 c_Qry += " '014964', "
 c_Qry += " '014995', "
 c_Qry += " '015003', "
 c_Qry += " '015012', "
 c_Qry += " '015022', "
 c_Qry += " '015065', "
 c_Qry += " '015095', "
 c_Qry += " '015122', "
 c_Qry += " '015129', "
 c_Qry += " '015130', "
 c_Qry += " '015156', "
 c_Qry += " '015208', "
 c_Qry += " '015209', "
 c_Qry += " '015220', "
 c_Qry += " '015334', "
 c_Qry += " '015357', "
 c_Qry += " '015432', "
 c_Qry += " '015457', "
 c_Qry += " '015503', "
 c_Qry += " '015506', "
 c_Qry += " '015519', "
 c_Qry += " '015526', "
 c_Qry += " '015529', "
 c_Qry += " '015633', "
 c_Qry += " '015726', "
 c_Qry += " '015733', "
 c_Qry += " '015758', "
 c_Qry += " '015886', "
 c_Qry += " '015934', "
 c_Qry += " '015942', "
 c_Qry += " '015951', "
 c_Qry += " '016076', "
 c_Qry += " '016132', "
 c_Qry += " '016152', "
 c_Qry += " '016221', "
 c_Qry += " '016272', "
 c_Qry += " '016283', "
 c_Qry += " '016288', "
 c_Qry += " '016293', "
 c_Qry += " '016313', "
 c_Qry += " '016361', "
 c_Qry += " '016425', "
 c_Qry += " '016487', "
 c_Qry += " '016520', "
 c_Qry += " '016526', "
 c_Qry += " '016532', "
 c_Qry += " '016560', "
 c_Qry += " '016590', "
 c_Qry += " '016608', "
 c_Qry += " '016619', "
 c_Qry += " '016627', "
 c_Qry += " '016775', "
 c_Qry += " '016852', "
 c_Qry += " '016871', "
 c_Qry += " '016880', "
 c_Qry += " '016892', "
 c_Qry += " '016913', "
 c_Qry += " '016926', "
 c_Qry += " '017046', "
 c_Qry += " '017069', "
 c_Qry += " '017075', "
 c_Qry += " '017206', "
 c_Qry += " '017344', "
 c_Qry += " '017360', "
 c_Qry += " '017371', "
 c_Qry += " '017398', "
 c_Qry += " '017652', "
 c_Qry += " '017773', "
 c_Qry += " '017815', "
 c_Qry += " '017862', "
 c_Qry += " '017880', "
 c_Qry += " '017882', "
 c_Qry += " '017966', "
 c_Qry += " '018001', "
 c_Qry += " '018082', "
 c_Qry += " '018088', "
 c_Qry += " '018115', "
 c_Qry += " '018123', "
 c_Qry += " '018135', "
 c_Qry += " '018157', "
 c_Qry += " '018165', "
 c_Qry += " '018167', "
 c_Qry += " '018271', "
 c_Qry += " '018272', "
 c_Qry += " '018277', "
 c_Qry += " '018287', "
 c_Qry += " '018364', "
 c_Qry += " '018414', "
 c_Qry += " '018469', "
 c_Qry += " '018535', "
 c_Qry += " '018550', "
 c_Qry += " '018565', "
 c_Qry += " '018610', "
 c_Qry += " '018612', "
 c_Qry += " '018625', "
 c_Qry += " '018679', "
 c_Qry += " '018728', "
 c_Qry += " '018735', "
 c_Qry += " '018743', "
 c_Qry += " '018752', "
 c_Qry += " '018768', "
 c_Qry += " '018820', "
 c_Qry += " '018936', "
 c_Qry += " '019056', "
 c_Qry += " '019072', "
 c_Qry += " '019134', "
 c_Qry += " '019140', "
 c_Qry += " '019177', "
 c_Qry += " '019229', "
 c_Qry += " '019345', "
 c_Qry += " '019417', "
 c_Qry += " '019471', "
 c_Qry += " '019611', "
 c_Qry += " '019613', "
 c_Qry += " '019619', "
 c_Qry += " '019627', "
 c_Qry += " '019710', "
 c_Qry += " '019769', "
 c_Qry += " '019854', "
 c_Qry += " '019896', "
 c_Qry += " '019965', "
 c_Qry += " '019989', "
 c_Qry += " '019999', "
 c_Qry += " '020057', "
 c_Qry += " '020122', "
 c_Qry += " '020142', "
 c_Qry += " '020215', "
 c_Qry += " '020216', "
 c_Qry += " '020298', "
 c_Qry += " '020300', "
 c_Qry += " '020635', "
 c_Qry += " '020676', "
 c_Qry += " '020863', "
 c_Qry += " '020892', "
 c_Qry += " '020897', "
 c_Qry += " '020903', "
 c_Qry += " '020976', "
 c_Qry += " '021051', "
 c_Qry += " '021174', "
 c_Qry += " '021245', "
 c_Qry += " '021277', "
 c_Qry += " '021443', "
 c_Qry += " '021498', "
 c_Qry += " '021531', "
 c_Qry += " '021660', "
 c_Qry += " '021794', "
 c_Qry += " '021876', "
 c_Qry += " '021915', "
 c_Qry += " '021963', "
 c_Qry += " '021977', "
 c_Qry += " '022078', "
 c_Qry += " '022127', "
 c_Qry += " '022147', "
 c_Qry += " '022153', "
 c_Qry += " '022154', "
 c_Qry += " '022190', "
 c_Qry += " '022232', "
 c_Qry += " '022295', "
 c_Qry += " '022511', "
 c_Qry += " '022550', "
 c_Qry += " '022558', "
 c_Qry += " '022581', "
 c_Qry += " '022618', "
 c_Qry += " '022661', "
 c_Qry += " '022813', "
 c_Qry += " '022830', "
 c_Qry += " '022865', "
 c_Qry += " '022913', "
 c_Qry += " '023098', "
 c_Qry += " '023134', "
 c_Qry += " '023152', "
 c_Qry += " '023200', "
 c_Qry += " '023244', "
 c_Qry += " '023287', "
 c_Qry += " '023312', "
 c_Qry += " '023399', "
 c_Qry += " '023403', "
 c_Qry += " '023407', "
 c_Qry += " '023576', "
 c_Qry += " '023662', "
 c_Qry += " '023683', "
 c_Qry += " '023709', "
 c_Qry += " '023720', "
 c_Qry += " '023858', "
 c_Qry += " '023957', "
 c_Qry += " '024309', "
 c_Qry += " '024320', "
 c_Qry += " '024443', "
 c_Qry += " '024448', "
 c_Qry += " '024519', "
 c_Qry += " '024622', "
 c_Qry += " '024636', "
 c_Qry += " '024713', "
 c_Qry += " '024726', "
 c_Qry += " '024804', "
 c_Qry += " '024876', "
 c_Qry += " '024971', "
 c_Qry += " '024999', "
 c_Qry += " '025017', "
 c_Qry += " '025021', "
 c_Qry += " '025049', "
 c_Qry += " '025085', "
 c_Qry += " '025122', "
 c_Qry += " '025201', "
 c_Qry += " '025257', "
 c_Qry += " '025263', "
 c_Qry += " '025358', "
 c_Qry += " '025369', "
 c_Qry += " '025501', "
 c_Qry += " '025516', "
 c_Qry += " '025561', "
 c_Qry += " '025573', "
 c_Qry += " '025585', "
 c_Qry += " '025608', "
 c_Qry += " '025650', "
 c_Qry += " '025707', "
 c_Qry += " '025756', "
 c_Qry += " '025899', "
 c_Qry += " '025955', "
 c_Qry += " '025973', "
 c_Qry += " '025974', "
 c_Qry += " '025979', "
 c_Qry += " '026040', "
 c_Qry += " '026150', "
 c_Qry += " '026176', "
 c_Qry += " '026189', "
 c_Qry += " '026202', "
 c_Qry += " '026221', "
 c_Qry += " '026241', "
 c_Qry += " '026433', "
 c_Qry += " '026444', "
 c_Qry += " '026457', "
 c_Qry += " '026481', "
 c_Qry += " '026509', "
 c_Qry += " '026523', "
 c_Qry += " '026527', "
 c_Qry += " '026609', "
 c_Qry += " '026633', "
 c_Qry += " '026653', "
 c_Qry += " '026711', "
 c_Qry += " '026760', "
 c_Qry += " '026790', "
 c_Qry += " '026858', "
 c_Qry += " '026866', "
 c_Qry += " '026904', "
 c_Qry += " '026910', "
 c_Qry += " '026911', "
 c_Qry += " '026961', "
 c_Qry += " '027025', "
 c_Qry += " '027148', "
 c_Qry += " '027174', "
 c_Qry += " '027306', "
 c_Qry += " '027390', "
 c_Qry += " '027408', "
 c_Qry += " '027421', "
 c_Qry += " '027559', "
 c_Qry += " '027646', "
 c_Qry += " '027647', "
 c_Qry += " '027674', "
 c_Qry += " '027777', "
 c_Qry += " '027829', "
 c_Qry += " '027868', "
 c_Qry += " '027871', "
 c_Qry += " '027991', "
 c_Qry += " '028167', "
 c_Qry += " '028256', "
 c_Qry += " '028307', "
 c_Qry += " '028381', "
 c_Qry += " '028436', "
 c_Qry += " '028616', "
 c_Qry += " '028662', "
 c_Qry += " '028663', "
 c_Qry += " '028699', "
 c_Qry += " '028744', "
 c_Qry += " '028758', "
 c_Qry += " '028769', "
 c_Qry += " '028780', "
 c_Qry += " '028782', "
 c_Qry += " '028829', "
 c_Qry += " '028918', "
 c_Qry += " '028923', "
 c_Qry += " '028928', "
 c_Qry += " '028971', "
 c_Qry += " '028979', "
 c_Qry += " '029047', "
 c_Qry += " '029055', "
 c_Qry += " '029065', "
 c_Qry += " '029124', "
 c_Qry += " '029125', "
 c_Qry += " '029135', "
 c_Qry += " '029187', "
 c_Qry += " '029219', "
 c_Qry += " '029261', "
 c_Qry += " '029265', "
 c_Qry += " '029280', "
 c_Qry += " '029365', "
 c_Qry += " '029377', "
 c_Qry += " '029424', "
 c_Qry += " '029454', "
 c_Qry += " '029491', "
 c_Qry += " '029535', "
 c_Qry += " '029542', "
 c_Qry += " '029605', "
 c_Qry += " '029687', "
 c_Qry += " '029694', "
 c_Qry += " '029721', "
 c_Qry += " '029735', "
 c_Qry += " '029818', "
 c_Qry += " '029838', "
 c_Qry += " '029900', "
 c_Qry += " '030003', "
 c_Qry += " '030054', "
 c_Qry += " '030068', "
 c_Qry += " '030075', "
 c_Qry += " '030085', "
 c_Qry += " '030101', "
 c_Qry += " '030138', "
 c_Qry += " '030209', "
 c_Qry += " '030310', "
 c_Qry += " '030465', "
 c_Qry += " '030518', "
 c_Qry += " '030601', "
 c_Qry += " '030619', "
 c_Qry += " '030653', "
 c_Qry += " '030716', "
 c_Qry += " '030730', "
 c_Qry += " '030753', "
 c_Qry += " '030761', "
 c_Qry += " '030772', "
 c_Qry += " '030814', "
 c_Qry += " '030818', "
 c_Qry += " '030824', "
 c_Qry += " '030930', "
 c_Qry += " '030954', "
 c_Qry += " '031023', "
 c_Qry += " '031067', "
 c_Qry += " '031068', "
 c_Qry += " '031093', "
 c_Qry += " '031132', "
 c_Qry += " '031145', "
 c_Qry += " '031200', "
 c_Qry += " '031234', "
 c_Qry += " '031265', "
 c_Qry += " '031361', "
 c_Qry += " '031398', "
 c_Qry += " '031455', "
 c_Qry += " '031502', "
 c_Qry += " '031518', "
 c_Qry += " '031531', "
 c_Qry += " '031539', "
 c_Qry += " '031546', "
 c_Qry += " '031566', "
 c_Qry += " '031671', "
 c_Qry += " '031732', "
 c_Qry += " '031744', "
 c_Qry += " '031757', "
 c_Qry += " '031784', "
 c_Qry += " '031801', "
 c_Qry += " '031807', "
 c_Qry += " '031857', "
 c_Qry += " '031949', "
 c_Qry += " '031983', "
 c_Qry += " '032008', "
 c_Qry += " '032035', "
 c_Qry += " '032040', "
 c_Qry += " '032088', "
 c_Qry += " '032119', "
 c_Qry += " '032147', "
 c_Qry += " '032210', "
 c_Qry += " '032243', "
 c_Qry += " '032294', "
 c_Qry += " '032300', "
 c_Qry += " '032353', "
 c_Qry += " '032375', "
 c_Qry += " '032402', "
 c_Qry += " '032423', "
 c_Qry += " '032430', "
 c_Qry += " '032452', "
 c_Qry += " '032454', "
 c_Qry += " '032460', "
 c_Qry += " '032514', "
 c_Qry += " '032521', "
 c_Qry += " '032556', "
 c_Qry += " '032676', "
 c_Qry += " '032755', "
 c_Qry += " '032775', "
 c_Qry += " '032830', "
 c_Qry += " '032850', "
 c_Qry += " '032859', "
 c_Qry += " '032866', "
 c_Qry += " '032871', "
 c_Qry += " '032887', "
 c_Qry += " '032906', "
 c_Qry += " '032958', "
 c_Qry += " '032964', "
 c_Qry += " '033021', "
 c_Qry += " '033026', "
 c_Qry += " '033073', "
 c_Qry += " '033162', "
 c_Qry += " '033187', "
 c_Qry += " '033189', "
 c_Qry += " '033216', "
 c_Qry += " '033240', "
 c_Qry += " '033273', "
 c_Qry += " '033278', "
 c_Qry += " '033281', "
 c_Qry += " '033296', "
 c_Qry += " '033336', "
 c_Qry += " '033380', "
 c_Qry += " '033394', "
 c_Qry += " '033460', "
 c_Qry += " '033475', "
 c_Qry += " '033525', "
 c_Qry += " '033543', "
 c_Qry += " '033544', "
 c_Qry += " '033554', "
 c_Qry += " '033588', "
 c_Qry += " '033603', "
 c_Qry += " '033623', "
 c_Qry += " '033661', "
 c_Qry += " '033664', "
 c_Qry += " '033671', "
 c_Qry += " '033743', "
 c_Qry += " '033833', "
 c_Qry += " '033887', "
 c_Qry += " '033922', "
 c_Qry += " '033925', "
 c_Qry += " '033956', "
 c_Qry += " '034008', "
 c_Qry += " '034042', "
 c_Qry += " '034108', "
 c_Qry += " '034146', "
 c_Qry += " '034171', "
 c_Qry += " '034196', "
 c_Qry += " '034215', "
 c_Qry += " '034219', "
 c_Qry += " '034388', "
 c_Qry += " '034434', "
 c_Qry += " '034454', "
 c_Qry += " '034487', "
 c_Qry += " '034514', "
 c_Qry += " '034564', "
 c_Qry += " '034585', "
 c_Qry += " '034588', "
 c_Qry += " '034713', "
 c_Qry += " '034780', "
 c_Qry += " '034808', "
 c_Qry += " '034823', "
 c_Qry += " '034884', "
 c_Qry += " '034900', "
 c_Qry += " '034914', "
 c_Qry += " '034933', "
 c_Qry += " '034944', "
 c_Qry += " '034947', "
 c_Qry += " '034949', "
 c_Qry += " '034954', "
 c_Qry += " '034971', "
 c_Qry += " '034991', "
 c_Qry += " '035044', "
 c_Qry += " '035100', "
 c_Qry += " '035176', "
 c_Qry += " '035209', "
 c_Qry += " '035317', "
 c_Qry += " '035318', "
 c_Qry += " '035418', "
 c_Qry += " '035430', "
 c_Qry += " '035448', "
 c_Qry += " '035460', "
 c_Qry += " '035461', "
 c_Qry += " '035478', "
 c_Qry += " '035480', "
 c_Qry += " '035499', "
 c_Qry += " '035512', "
 c_Qry += " '035548', "
 c_Qry += " '035568', "
 c_Qry += " '035582', "
 c_Qry += " '035593', "
 c_Qry += " '035604', "
 c_Qry += " '035620', "
 c_Qry += " '035653', "
 c_Qry += " '035655', "
 c_Qry += " '035721', "
 c_Qry += " '035772', "
 c_Qry += " '035821', "
 c_Qry += " '035910', "
 c_Qry += " '035944', "
 c_Qry += " '036041', "
 c_Qry += " '036087', "
 c_Qry += " '036107', "
 c_Qry += " '036183', "
 c_Qry += " '036189', "
 c_Qry += " '036194', "
 c_Qry += " '036197', "
 c_Qry += " '036199', "
 c_Qry += " '036211', "
 c_Qry += " '036234', "
 c_Qry += " '036267', "
 c_Qry += " '036272', "
 c_Qry += " '036277', "
 c_Qry += " '036284', "
 c_Qry += " '036301', "
 c_Qry += " '036304', "
 c_Qry += " '036370', "
 c_Qry += " '036466', "
 c_Qry += " '036474', "
 c_Qry += " '036513', "
 c_Qry += " '036545', "
 c_Qry += " '036628', "
 c_Qry += " '036630', "
 c_Qry += " '036653', "
 c_Qry += " '036700', "
 c_Qry += " '036743', "
 c_Qry += " '036784', "
 c_Qry += " '036794', "
 c_Qry += " '036842', "
 c_Qry += " '036850', "
 c_Qry += " '036868', "
 c_Qry += " '036875', "
 c_Qry += " '036905', "
 c_Qry += " '036948', "
 c_Qry += " '037010', "
 c_Qry += " '037043', "
 c_Qry += " '037049', "
 c_Qry += " '037089', "
 c_Qry += " '037103', "
 c_Qry += " '037106', "
 c_Qry += " '037130', "
 c_Qry += " '037142', "
 c_Qry += " '037181', "
 c_Qry += " '037269', "
 c_Qry += " '037283', "
 c_Qry += " '037346', "
 c_Qry += " '037369', "
 c_Qry += " '037391', "
 c_Qry += " '037441', "
 c_Qry += " '037444', "
 c_Qry += " '037504', "
 c_Qry += " '037612', "
 c_Qry += "	'037629' )	"
 c_Qry += " OR BA3_MATRIC IN ( 	'037633', "
 c_Qry += " '037654', "
 c_Qry += " '037657', "
 c_Qry += " '037671', "
 c_Qry += " '037679', "
 c_Qry += " '037727', "
 c_Qry += " '037865', "
 c_Qry += " '037894', "
 c_Qry += " '037896', "
 c_Qry += " '037899', "
 c_Qry += " '037907', "
 c_Qry += " '038053', "
 c_Qry += " '038072', "
 c_Qry += " '038089', "
 c_Qry += " '038135', "
 c_Qry += " '038142', "
 c_Qry += " '076399', "
 c_Qry += " '076775', "
 c_Qry += " '077136', "
 c_Qry += " '077219', "
 c_Qry += " '077240', "
 c_Qry += " '077491', "
 c_Qry += " '078365', "
 c_Qry += " '078436', "
 c_Qry += " '078503', "
 c_Qry += " '078514', "
 c_Qry += " '078618', "
 c_Qry += " '078673', "
 c_Qry += " '078732', "
 c_Qry += " '079048', "
 c_Qry += " '079155', "
 c_Qry += " '079243', "
 c_Qry += " '079424', "
 c_Qry += " '079472', "
 c_Qry += " '079599', "
 c_Qry += " '079711', "
 c_Qry += " '079727', "
 c_Qry += " '079762', "
 c_Qry += " '079936', "
 c_Qry += " '080004', "
 c_Qry += " '080052', "
 c_Qry += " '080081', "
 c_Qry += " '080122', "
 c_Qry += " '080127', "
 c_Qry += " '080191', "
 c_Qry += " '080210', "
 c_Qry += " '080470', "
 c_Qry += " '080512', "
 c_Qry += " '080557', "
 c_Qry += " '080620', "
 c_Qry += " '080676', "
 c_Qry += " '080712', "
 c_Qry += " '080879', "
 c_Qry += " '081784', "
 c_Qry += " '081806', "
 c_Qry += " '081865', "
 c_Qry += " '081882', "
 c_Qry += " '082634', "
 c_Qry += " '082713', "
 c_Qry += " '082717', "
 c_Qry += " '082751', "
 c_Qry += " '082770', "
 c_Qry += " '083017', "
 c_Qry += " '083295', "
 c_Qry += " '084005', "
 c_Qry += " '084013', "
 c_Qry += " '084090', "
 c_Qry += " '084115', "
 c_Qry += " '084196', "
 c_Qry += " '084201', "
 c_Qry += " '084234', "
 c_Qry += " '084245', "
 c_Qry += " '084393', "
 c_Qry += " '084415', "
 c_Qry += " '084472', "
 c_Qry += " '084653', "
 c_Qry += " '084791', "
 c_Qry += " '084809', "
 c_Qry += " '084839', "
 c_Qry += " '089161', "
 c_Qry += " '089243', "
 c_Qry += " '089330', "
 c_Qry += " '089365', "
 c_Qry += " '089372', "
 c_Qry += " '089373', "
 c_Qry += " '089455', "
 c_Qry += " '089614', "
 c_Qry += " '089633', "
 c_Qry += " '089723', "
 c_Qry += " '089814', "
 c_Qry += " '089953', "
 c_Qry += " '090108', "
 c_Qry += " '090155', "
 c_Qry += " '090272', "
 c_Qry += " '090292', "
 c_Qry += " '090369', "
 c_Qry += " '090377', "
 c_Qry += " '090401', "
 c_Qry += " '090480', "
 c_Qry += " '090519', "
 c_Qry += " '090541', "
 c_Qry += " '090615', "
 c_Qry += " '090648', "
 c_Qry += " '090739', "
 c_Qry += " '090772', "
 c_Qry += " '090896', "
 c_Qry += " '090946', "
 c_Qry += " '090955', "
 c_Qry += " '090993', "
 c_Qry += " '091094', "
 c_Qry += " '091247', "
 c_Qry += " '091299', "
 c_Qry += " '091319', "
 c_Qry += " '091381', "
 c_Qry += " '091744', "
 c_Qry += " '091773', "
 c_Qry += " '091780', "
 c_Qry += " '091880', "
 c_Qry += " '091885', "
 c_Qry += " '091897', "
 c_Qry += " '092087', "
 c_Qry += " '092164', "
 c_Qry += " '092169', "
 c_Qry += " '092740', "
 c_Qry += " '092745', "
 c_Qry += " '092782', "
 c_Qry += " '092790', "
 c_Qry += " '092836', "
 c_Qry += " '092882', "
 c_Qry += " '092893', "
 c_Qry += " '093008', "
 c_Qry += " '093046', "
 c_Qry += " '093114', "
 c_Qry += " '093138', "
 c_Qry += " '093163', "
 c_Qry += " '093176', "
 c_Qry += " '093306', "
 c_Qry += " '093357', "
 c_Qry += " '093406', "
 c_Qry += " '093446', "
 c_Qry += " '093447', "
 c_Qry += " '093489', "
 c_Qry += " '093535', "
 c_Qry += " '093609', "
 c_Qry += " '093658', "
 c_Qry += " '093659', "
 c_Qry += " '093660', "
 c_Qry += " '093711', "
 c_Qry += " '093871', "
 c_Qry += " '094222') 	"

c_Qry += ") "
//c_Qry += " AND BBU_ANOMES = ' '        "
c_Qry += " AND BA3.D_E_L_E_T_ = ' '    "
c_Qry += " AND BBU.D_E_L_E_T_ = ' '    "


c_Qry += " ORDER BY  1, 2, 3, 4, 5, 6, 7, 8, 9, 10 "

TcQuery c_Qry New Alias "QRYFAM"

While !QRYFAM->( EOF() )  
		
	c_CodInt 	:= QRYFAM->BA3_CODINT
	c_CodEmp	:= QRYFAM->BA3_CODEMP
	c_Matric	:= QRYFAM->BA3_MATRIC
	c_CodFai 	:= QRYFAM->BBU_CODFAI
	c_IdaIdi 	:= QRYFAM->BBU_IDAINI
	c_IdaFin 	:= QRYFAM->BBU_IDAFIN
	c_VlrAnt 	:= QRYFAM->BBU_VALFAI
	c_TipUsr 	:= QRYFAM->BBU_TIPUSR
	n_ValRea 	:= QRYFAM->VAL_REA
	c_Indice 	:= QRYFAM->PCL_INDICE
	n_PerRea 	:= QRYFAM->PCL_PERCEN
	c_CodFor 	:= QRYFAM->BBU_CODFOR  
	c_MatFam    := c_CodInt + c_CodEmp + c_Matric 
	c_Conemp	:= QRYFAM->BA3_CONEMP
	c_VerCon	:= QRYFAM->BA3_VERCON
	c_SubCon	:= QRYFAM->BA3_SUBCON
	c_VerSub	:= QRYFAM->BA3_VERSUB
	c_CodPla	:= QRYFAM->BA3_CODPLA
	c_VerPla	:= QRYFAM->BA3_VERSAO
	
	
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Reajusta Familia                                                         Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	BBU->( dbGoTo( QRYFAM->RECBBU ) )
	BA3->( dbGoTo( QRYFAM->RECBA3 ) )
	Begin Transaction
	
	BP7->(RecLock("BP7",.T.))
	
	BP7->BP7_FILIAL := xFilial("BP7")
	BP7->BP7_OPEREA := c_CodInt
	BP7->BP7_CODREA := c_CodRea
	BP7->BP7_CODOPE := c_CodInt
	BP7->BP7_CODEMP := c_CodEmp
	BP7->BP7_MATRIC := c_Matric
	BP7->BP7_CODFAI := c_CodFai
	BP7->BP7_IDAINI := c_IdaIdi
	BP7->BP7_IDAFIN := c_IdaFin
	BP7->BP7_VLRANT := c_VlrAnt
	BP7->BP7_VLRREA := n_ValRea
	BP7->BP7_DATREA := dDataBase
	BP7->BP7_INDREA := c_Indice
	BP7->BP7_PERREA := n_PerRea
	BP7->BP7_CODFOR := c_CodFor    	
	
	
	BP7->(MsUnLock())
	
	BBU->(RecLock("BBU",.F.))
	
	BBU->BBU_VLRANT := c_VlrAnt
	BBU->BBU_ANOMES := c_AnoMes
	BBU->BBU_REJAPL := n_PerRea
	BBU->BBU_PERREJ := dDatabase
	BBU->BBU_VALFAI := n_ValRea
	BBU->BBU_AUTOMA := '1'
	
	BBU->(MsUnLock())  
    			
	//Inclui as Faixas de Desconto
	dbSelectArea("BFY")
	If BFY->(DbSeek(xFilial("BFY")+ QRYFAM->(BA3_CODINT+BA3_CODEMP+BA3_MATRIC+BA3_FORPAG+BBU_CODFAI) ))
	
		BFY->( RecLock("BFY",.F.))
		BFY->BFY_DATDE  := STOD("20150601")
		BFY->BFY_DATATE  := STOD("20160531")
		BFY->(MsUnlock())
		
			BFY->( RecLock("BFY",.T.))
			
		    BFY->BFY_FILIAL := xFilial("BFY")
			BFY->BFY_CODOPE := QRYFAM->BA3_CODINT
			BFY->BFY_CODEMP := QRYFAM->BA3_CODEMP
			BFY->BFY_MATRIC := QRYFAM->BA3_MATRIC
			BFY->BFY_CODFOR := QRYFAM->BA3_FORPAG
			BFY->BFY_CODFAI := BBU->BBU_CODFAI
			BFY->BFY_TIPUSR := BBU->BBU_TIPUSR
			BFY->BFY_GRAUPA := BBU->BBU_GRAUPA
			BFY->BFY_QTDDE  := 0
			BFY->BFY_QTDATE := 999
			BFY->BFY_VALOR  := IiF((QRYFAM->BA3_CODPLA =='0092' .AND. BBU->BBU_TIPUSR == "T") , 7.56, 11.43 ) 
			BFY->BFY_AUTOMA := "1"
			BFY->BFY_TIPO   := "1"
			BFY->BFY_DATDE  := STOD("20160601")
			BFY->(MsUnlock())
		
	EndIf		
	
	
	End Transaction
	QRYFAM->( dbSkip() ) 
	
	
		If !Empty( c_MatFam ) .AND. c_MatFam <> QRYFAM->BA3_CODINT + QRYFAM->BA3_CODEMP + QRYFAM->BA3_MATRIC
	
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Atualiza arquivos de familias processadas no lote...                     Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		
		BG9->(DbSetOrder(1))
		BG9->(DbSeek(xFilial("BG9")+c_CodInt + c_CodEmp ))
	
		If l_Opcional 
		
   			
			//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			//Ё Atualiza opcionais dos usuarios...                                       Ё
			//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
			BZX->(DbSetOrder(1))
			If BZX->(DbSeek(xFilial("BZX")+c_CodInt + c_CodEmp + c_Matric))
				While ! BZX->(Eof()) .And. BZX->(BZX_FILIAL+BZX_CODOPE+BZX_CODEMP+BZX_MATRIC) == xFilial("BZX")+c_CodInt + c_CodEmp + c_Matric
			
					c_CodOpc  	:= BZX->BZX_CODOPC
					c_VerOpc  	:= BZX->BZX_VEROPC  
					c_CodFor  	:= BZX->BZX_VEROPC  
					
					c_Qry 		:= "SELECT BBX_VALFAI FROM "+RetSqlName("BBX")+" WHERE BBX_FILIAL = '"+xFilial("BBX")+"' "
					c_Qry 		+= "AND BBX_CODIGO = '"+c_CodInt+c_CodEmp+"' "
					c_Qry 		+= "AND BBX_NUMCON = '"+c_Conemp+"' "
					c_Qry 		+= "AND BBX_VERCON = '"+c_VerCon+"' "
					c_Qry 		+= "AND BBX_SUBCON = '"+c_SubCon+"' "
					c_Qry 		+= "AND BBX_VERSUB = '"+c_VerSub+"' "
					c_Qry 		+= "AND BBX_CODPRO = '"+c_CodPla+"' "
					c_Qry 		+= "AND BBX_VERPRO = '"+c_VerPLa+"' "
					c_Qry 		+= "AND BBX_CODOPC = '"+c_CodOpc+"' "
					c_Qry 		+= "AND BBX_VEROPC = '"+c_VerOpc+"' "
					c_Qry 		+= "AND BBX_TIPUSR = DECODE('"+c_CodPla+"', '0092', '"+Iif(BZX->BZX_TIPREG == '00', 'T', 'D')+"', ' ' ) "
					c_Qry 		+= "AND D_E_L_E_T_ <> '*' "   
					
					TcQuery c_Qry New Alias "QRYOPC"
					
					If !( QRYOPC->( EOF() ) )
			
					//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
					//Ё Apura o valor com o reajuste...                                          Ё
					//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
					
					n_VlrRea := QRYOPC->BBX_VALFAI
					//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
					//Ё Joga para o historico o valor atual desta faixa...                       Ё
					//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
					BYI->(RecLock("BYI",.T.))
					BYI->BYI_FILIAL := xFilial("BYI")
					BYI->BYI_OPEREA := c_CodInt
					BYI->BYI_CODREA := c_CodRea
					BYI->BYI_CODOPE := c_CodInt
					BYI->BYI_CODEMP := c_CodEmp
					BYI->BYI_MATRIC := c_Matric
					BYI->BYI_TIPREG := BZX->BZX_TIPREG
					BYI->BYI_CODFAI := BZX->BZX_CODFAI
					BYI->BYI_IDAINI := BZX->BZX_IDAINI
					BYI->BYI_IDAFIN := BZX->BZX_IDAFIN
					BYI->BYI_VLRANT := BZX->BZX_VALFAI
					BYI->BYI_VLRREA := n_VlrRea
					BYI->BYI_DATREA := dDataBase
					BYI->BYI_INDREA := c_Indice
					BYI->BYI_PERREA := n_PerOpc
					BYI->BYI_CODFOR := BZX->BZX_CODFOR
					BYI->BYI_CODOPC := BZX->BZX_CODOPC
					BYI->BYI_VEROPC := BZX->BZX_VEROPC
					BYI->(MsUnLock())
					//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
					//Ё Atualiza o valor em cada faixa etaria da familia...                      Ё
					//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
					BZX->(RecLock("BZX",.F.))
					BZX->BZX_VLRANT := BZX->BZX_VALFAI
					BZX->BZX_ANOMES := c_AnoMes
					BZX->BZX_VALFAI := n_VlrRea
					BZX->(MsUnLock())
					//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
					//Ё Acessa proximo registro...                                               Ё
					//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
					EndIf     
					
					QRYOPC->( dbCloseArea() )
					BZX->(DbSkip())
				Enddo
			Endif
			
		Endif    
		
	EndIf 
	
EndDo  

eNDiF  



If .f.//l_AtuProd
	
	c_Qry := " SELECT  (case when PCL_PERCEN < 0 then Round( BTN_VALFAI - ((BTN_VALFAI * PCL_PERCEN * -1 ) / 100) ,2) else "
	c_Qry += "                                 Round( BTN_VALFAI + ((BTN_VALFAI * PCL_PERCEN  ) / 100) ,2)  end ) VAL_REA, "
	c_Qry += "                                PCL_PERCEN, "
	c_Qry += "                                PCL_INDICE, "
	c_Qry += "                                BTN.R_E_C_N_O_ BTNREC "
	
	c_Qry += " FROM PCK010 INNER JOIN PCL010 PCL ON PCL_FILIAL = ' ' "
	c_Qry += "                  AND PCL_CODSEQ = PCK_CODSEQ   "
	
	
	c_Qry += "                  INNER JOIN BTN010 BTN ON BTN_FILIAL = ' ' "
	c_Qry += "                  AND BTN_CODIGO = '0001'||PCL_EMPRES "
	c_Qry += "                  AND BTN_NUMCON = PCL_CONTRA "
	c_Qry += "                  AND BTN_SUBCON = PCL_SUBCON "
	c_Qry += "                  AND BTN_CODPRO = PCL_PRODUT "
	
	c_Qry += "                  AND BTN_TIPUSR = DECODE(PCL_TITULA, ' ', BTN_TIPUSR, PCL_TITULA)   "
	
	c_Qry += " WHERE PCL_CODSEQ = '000004'    "
	c_Qry += " AND  BTN.D_E_L_E_T_ = ' '   "
	c_Qry += " AND  PCL.D_E_L_E_T_ = ' '   "
	
	TcQuery c_Qry New Alias "QRYPRO"
	
	While !QRYPRO->( eof() )
			Begin Transaction
		n_PerOpc	:= QRYPRO->PCL_PERCEN
		c_CodInt    := "0001"
		n_VlrRea	:= QRYPRO->VAL_REA
		c_Indice 	:= QRYPRO->PCL_INDICE
		
		dbSelectArea("BTN")
		BTN->( dbGoTo(QRYPRO->BTNREC) )
		

		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Apura o valor com o reajuste...                                          Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Joga para o historico o valor atual desta faixa...                       Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		BYC->(RecLock("BYC",.T.))
		BYC->BYC_FILIAL := xFilial("BYC")
		BYC->BYC_OPEREA := c_CodInt
		BYC->BYC_CODREA := c_CodRea
		BYC->BYC_CODOPE := SUBS(BTN->BTN_CODIGO,1,4)
		BYC->BYC_CODEMP := SUBS(BTN->BTN_CODIGO,5,4)
		BYC->BYC_CONEMP := BTN->BTN_NUMCON
		BYC->BYC_VERCON := BTN->BTN_VERCON
		BYC->BYC_SUBCON := BTN->BTN_SUBCON
		BYC->BYC_VERSUB := BTN->BTN_VERSUB
		BYC->BYC_CODPRO := BTN->BTN_CODPRO
		BYC->BYC_VERPRO := BTN->BTN_VERPRO
		BYC->BYC_CODFAI := BTN->BTN_CODFAI
		BYC->BYC_IDAINI := BTN->BTN_IDAINI
		BYC->BYC_IDAFIN := BTN->BTN_IDAFIN
		BYC->BYC_VLRANT := BTN->BTN_VALFAI
		BYC->BYC_VLRREA := n_VlrRea
		BYC->BYC_DATREA := dDataBase
		BYC->BYC_INDREA := c_Indice
		BYC->BYC_PERREA := n_PerOpc
		BYC->BYC_CODFOR := BTN->BTN_CODFOR
		BYC->(MsUnLock())
		
		//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		//Ё Atualiza o valor em cada faixa etaria da familia...                      Ё
		//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
		
		BTN->(RecLock("BTN",.F.))
		BTN->BTN_VLRANT := BTN->BTN_VALFAI
		BTN->BTN_ANOMES := c_AnoMes
		BTN->BTN_VALFAI := n_VlrRea
		BTN->BTN_REJAPL := n_PerOpc
		BTN->BTN_PERREJ := dDataBase
		BTN->(MsUnLock())
		
		
	End Transaction	
		QRYPRO->(dbSkip())
		
	EndDo
EndIF 
          ALERT("fIM")
	
   //	RESET ENVIRONMENT
		
Return      


