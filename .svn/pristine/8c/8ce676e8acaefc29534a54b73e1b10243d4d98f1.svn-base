
/*/
複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
굇旼컴컴컴컴컫컴컴컴컴컫컴컴컴컫컴컴컴컴컴컴컴컴컴컴컴컴쩡컴컴컫컴컴컴컴컴엽굇
굇쿑uncao     PLSR620  Autor  Guilherme Brunoro       Data  05.02.03 낢굇
굇쳐컴컴컴컴컵컴컴컴컴컨컴컴컴컨컴컴컴컴컴컴컴컴컴컴컴컴좔컴컴컨컴컴컴컴컴눙굇
굇쿏escricao  Lista Atendimento Medico                                   낢굇
굇쳐컴컴컴컴컵컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴눙굇
굇쿞intaxe    PLSR620()       	                                          낢굇
굇쳐컴컴컴컴컵컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴눙굇
굇 Uso       Advanced Protheus                                          낢굇
굇쳐컴컴컴컴컨컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴눙굇
굇 Alteracoes desde sua construcao inicial                               낢굇
굇쳐컴컴컴컴컫컴컴컴쩡컴컴컴컴컴컴쩡컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴눙굇
굇 Data      BOPS  Programador  Breve Descricao                       낢굇
굇쳐컴컴컴컴컵컴컴컴탠컴컴컴컴컴컴탠컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴눙굇
굇23/09/03  쿛adrao|Natie        | Padronizacao Versao                   낢굇
굇                쿙atie         Acerto no  Tratam.cons.Canceladas     낢굇
굇05/03/04  쿛adrao|Brunoro      | Troca da funcao CONVERT na query por  낢굇
굇                |             | comando advpl para calcular o tempo   낢굇
굇                |             | de consulta, para funcionar no ORACLE 낢굇
굇읕컴컴컴컴컨컴컴컴좔컴컴컴컴컴컴좔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴袂굇
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽賽
/*/
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Associa arquivo de definicoes                                            
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
#INCLUDE "PLSMGER.CH"
#INCLUDE "PROTHEUS.CH"
#INCLUDE "TOPCONN.CH"
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Define nome da funcao                                                    
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
User Function XPLSR620()
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Define variaveis padroes para todos os relatorios...                     
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
PRIVATE nQtdLin     := 58
//PRIVATE nLimite     := 132
PRIVATE nLimite     := 220
PRIVATE cTamanho    := "G"       // P=Pequeno;M=Medio;G=Grande -> P=80;M=132;G=220 (colunas)
PRIVATE cTitulo     := "Relatorio de Atendimento Medico" 
PRIVATE cDesc1      := "Este relatorio ira emitir a listagem de" 
PRIVATE cDesc2      := "Atendimentos Medicos." 
PRIVATE cDesc3      := ""
PRIVATE cAlias      := "BBD" 
PRIVATE cPerg       := "PLR620" 
PRIVATE cRel        := "XPLSR620" 
PRIVATE nli         := 01   
PRIVATE nQtdini     := nli  
PRIVATE m_pag       := 1    
PRIVATE lCompres    := .F. 
PRIVATE lDicion     := .F. 
PRIVATE lFiltro     := .T. 
PRIVATE lCrystal    := .F.
PRIVATE aOrderns    := {"Codigo do Medico+Data do Atendimento+Hora do atendimento"}
PRIVATE aReturn     := { "", 1,"", 1, 1, 1, "",1 } 
PRIVATE lAbortPrint := .F. 
PRIVATE cCabec1     := "MEDICO (ESPECIALIDADE)" 
//Motta
//PRIVATE cCabec2     := "NUM. ATEND.  SALA DATA     HORA   CONTRATO     SUB-CONT. DESCRICAO                      MATRICULA           PACIENTE                            TELEFONE  INIC. FINAL   TEMPO  ENC TIPO     OPERADOR      CANCELAMENTO"
PRIVATE cCabec2     := "NUM. ATEND.  SALA DATA     HORA   CONTRATO     SUB-CONT. DESCRICAO                      MATRICULA           PACIENTE                            TELEFONE  INIC. FINAL   TEMPO  ENC TIPO   OPERADOR      CANCELAMENTO      X"
//
PRIVATE nColuna     := 00 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Dados do parametro...                                                    
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
PRIVATE cDatDe
PRIVATE cDatAte
PRIVATE cMedDe
PRIVATE cMedAte
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Variaveis de mascara (picture)                                           
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
PRIVATE pQtd        := "99"
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Testa ambiente do relatorio somente top...                               
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If ! PLSRelTop()
   Return
Endif    
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Chama SetPrint (padrao)                                                  
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
cRel  := SetPrint(cAlias,cRel,cPerg,@cTitulo,cDesc1,cDesc2,cDesc3,lDicion,aOrderns,lCompres,cTamanho,{},lFiltro,lCrystal)
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Verifica se foi cancelada a operacao (padrao)                            
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If nLastKey  == 27 
   Return
Endif
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Acessa parametros do relatorio...                                        
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
Pergunte(cPerg,.F.) 

cDatDe  := mv_par01
cDatAte := mv_par02
cMedDe  := mv_par03
cMedAte := mv_par04  
nSomAAG := mv_par05
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Configura impressora (padrao)                                            
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
SetDefault(aReturn,cAlias) 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Emite relat줿io                                                          
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
MsAguarde({|| XR620Imp() }, cTitulo, "", .T.) 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Fim da rotina                                                            
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
Return
/*/
複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
굇旼컴컴컴컴컴쩡컴컴컴컴컫컴컴컴컫컴컴컴컴컴컴컴컴컴컴컴컫컴컴컴쩡컴컴컴컴커굇
굇쿛rograma    XR620Imp   Autor  Guilherme Brunoro      Data  29.01.03 낢
굇쳐컴컴컴컴컴탠컴컴컴컴컨컴컴컴컨컴컴컴컴컴컴컴컴컴컴컴컨컴컴컴좔컴컴컴컴캑굇
굇쿏escricao   Imprime...                                                 낢
굇읕컴컴컴컴컴좔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸굇
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
/*/
Static Function XR620Imp()
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Define variaveis...                                                      
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
LOCAL cSQL
LOCAL nOrdSel  := aReturn[8] 
LOCAL cCodCre    
LOCAL cCodUsu
LOCAL cTempo             
LOCAL cTipo
LOCAL cCodCanc := ""
LOCAL nUsuCre  := 0
LOCAL nTotUsu  := 0
LOCAL nTotEnc  := 0
LOCAL nTotCon  := 0
LOCAL nTotRev  := 0
LOCAL nTotPro  := 0                                               
LOCAL nTotAte  := 0                                               
LOCAL nTotCac  := 0                                               
LOCAL nTemIni  := 0
LOCAL nTemFin  := 0
LOCAL nTempo   := 0
LOCAL nHora    := 0
LOCAL nMinuto  := 0      

Local cAAG     := " "
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Cadastro da Rede de Atendimento...                                       
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
LOCAL cBBDName := RetSQLName("BBD")
LOCAL cBTHName := RetSQLName("BTH")
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Define variaveis de trabalho...                                          
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Exibe mensagem...                                                        
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
MsProcTxt(PLSTR0001) 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Faz filtro no arquivo...                                                 
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸   

//Motta
cSQL := "SELECT TRIM(PLS_PRA_PROJSERV_ATIVO_MS(SubStr(BBD_CODPAC,1,4),SubStr(BBD_CODPAC,5,4),SubStr(BBD_CODPAC,9,6),SubStr(BBD_CODPAC,15,2),'0041',BBD_DATA)) AAG,"
cSQL += "       BBD_NUMATE,BBD_CODINT,BBD_NUMATE,BBD_DATA,BBD_HORA,BBD_CODIGO,BBD_CODESP,BBD_NOME,BBD_CODPAC,"
cSQL += "BBD_TELEFO,BBD_NSALA,BBD_ENCAIX,BBD_TIPO,BBD_USUOPE,BBD_STATUS,BBD_CODLOC "
cSQL += "FROM "+cBBDName+" "
cSQL += "WHERE "
cSQL += " D_E_L_E_T_ = ' ' AND "
cSQL += " BBD_FILIAL = '   "  + xFilial("BBD")+"' "     
cSQL += " AND BBD_DATA >= '"  + Dtos(cDatDe)+"' AND BBD_DATA <= '"+Dtos(cDatAte)+"' "
cSQL += " AND BBD_CODIGO >= '"+ cMedDe+"' AND BBD_CODIGO     <= '" +cMedAte      +"' " 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Se houver filtro executa parse para converter expressoes adv para SQL    
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If ! Empty(aReturn[7])
   cSQL += " AND (" + PLSParSQL(aReturn[7])+" ) "
Endif      
// Motta
If nSomAAG == 2 
	cSQL += " AND TRIM(PLS_PRA_PROJSERV_ATIVO_MS(SubStr(BBD_CODPAC,1,4),SubStr(BBD_CODPAC,5,4),SubStr(BBD_CODPAC,9,6),SubStr(BBD_CODPAC,15,2),'0041',BBD_DATA))='S' " 
Endif
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// De acordo com a ordem....                                                
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If     nOrdSel == 1                        
       cSQL += " ORDER BY BBD_CODIGO,BBD_DATA,BBD_HORA "
Endif       

PLSQuery(cSQL,"BBDTrb")
BBDTrb->(DbGotop())
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Imprime Cabecalho...                                               
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
R620Cabec()
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Inicio da impressao dos detalhes...                                      
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
While ! BBDTrb->(Eof())
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Exibe mensagem...                                                  
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      MsProcTXT("Imprimindo "+BBDTrb->BBD_CODIGO+"...")
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Verifica se foi abortada a impressao...                            
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      If Interrupcao(lAbortPrint)
         nLi ++
         @ nLi, nColuna pSay PLSTR0002
         Exit
      Endif                       
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // verifica proxima pagina...                                         
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      If nLi > nQtdLin
         R620Cabec()
      Endif 
      cCodCre := BBDTrb->BBD_CODIGO
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Posiciono no prestador...                                          
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      BAU->(DbSetOrder(01))
      If ! BAU->(DbSeek(xFilial("BAU")+BBDTrb->BBD_CODIGO))
         MsgStop("Prestador nao encontrado: "+BBDTrb->BBD_CODIGO)
      Endif
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Posiciono na especialidade...                                      
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      BAQ->(DbSetOrder(01))
      If ! BAQ->(DbSeek(xFilial("BAQ")+BBDTrb->(BBD_CODINT+BBD_CODESP)))
         MsgStop("Especialidade nao encontrada: "+BBDTrb->BBD_CODESP)
      Endif
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Imprime Grupo...                                                   
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      @ ++nLi, nColuna pSay IIF(BAU->BAU_SEXO="0","Dr. ","Dra. ")+Alltrim(BAU->BAU_NOME)+" ("+AllTrim(BAQ->BAQ_DESCRI)+")"
      nLi ++

      While cCodCre == BBDTrb->BBD_CODIGO
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Verifico Agendas Canceladas...                                           
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
			cCodCanc := ""
			If BBDTrb->BBD_STATUS  == "7" 

				//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
				// Posiciono no Arquivo de Agendas Canceladas...                            
				//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
				BHY->(DbSetOrder(1))							//-- BHY_FILIAL + BHY_CODPAC + BHY_CODESP + DTOS(BHY_DATA)+BHY_HORA
				If ! BHY->(DbSeek(xFilial("BHY")+BBDTrb->(BBD_CODIGO+BBD_CODINT+BBD_CODLOC+DTOS(BBD_DATA)+BBD_HORA)))
					BBDTrb->(DbSkip())
					Loop
				Else
					nTotCac ++
                     //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
                     // Posiciono no Arquivo de Motivo de Agendas Canceladas...                  
                     //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
                     cCodCanc	:= LEFT(fDesc("BTJ",BHY->BHY_CODCAN , "BTJ_DESCRI" ),18)
				Endif
            Endif
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Posiciono no arquivo BTH ( Atendimento x Consultas)...             
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            cSQL := "SELECT BTH_HORINI,BTH_HORFIN "
            cSQL += "FROM "+cBTHName+" "
            cSQL += "WHERE "
            cSQL += " BTH_FILIAL = '"+xFilial("BTH")+"' "     
            cSQL += " AND "+cBTHName+".D_E_L_E_T_ = ' '  "
            cSQL += " AND BTH_CODATE = '"+BBDTrb->BBD_NUMATE+"'"

			PLSQuery(cSQL,"BTHTrb")
			BTHTrb->(DbGotop())
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Monta matricula...                                                 
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            cCodUsu := Substr(BBDTrb->BBD_CODPAC,1,4)+"."+Substr(BBDTrb->BBD_CODPAC,5,4)+"."+;
                        Substr(BBDTrb->BBD_CODPAC,9,6)+"."+Substr(BBDTrb->BBD_CODPAC,15,2)
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Posiciono no USUARIO...                                            
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            BA1->(DbSetOrder(02))									//BA1_FILIAL + BA1_CODINT + BA1_CODEMP + BA1_MATRIC + BA1_TIPREG
            BA1->(DbSeek(xFilial("BA1")+Substr(BBDTrb->BBD_CODPAC,1,16)))
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Posiciono no Sub-Contrato...                                             
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            BQC->(DbSetOrder(1))									// BQC_CODIGO + BQC_NUMCON + BQC_VERCON + BQC_SUBCON + BQC_VERSUB
            BQC->(DbSeek(xFilial("BQC")+BA1->(BA1_CODINT+BA1_CODEMP+BA1_CONEMP+BA1_VERCON+BA1_SUBCON+BA1_VERSUB)))
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Calculo o tempo gasto na consulta...                               
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            If Empty(BTHTrb->BTH_HORINI) .Or. Empty(BTHTrb->BTH_HORFIN)
               cTempo  := Space(05)
            Else
		       nTemFin := Val(Substr(BTHTrb->BTH_HORFIN,1,2))*60 + Val(Substr(BTHTrb->BTH_HORFIN,4,2))
		       nTemIni := Val(Substr(BTHTrb->BTH_HORINI,1,2))*60 + Val(Substr(BTHTrb->BTH_HORINI,4,2))		    
		       nTempo  := nTemFin - nTemIni
               If nTempo > 60
                  nHora   := Int(nTempo/60)
                  nMinuto := Mod(nTempo,60)
			      cTempo  := Strzero(nHora,2)+":"+Strzero(nMinuto,2)
               Else
                  cTempo := "00:"+Strzero(nTempo,2)
               Endif
            Endif
            //Motta
            //cTipo   := Substr(X3combo("BBD_TIPO",BBDTrb->BBD_TIPO),1,8)
            cTipo   := Substr(X3combo("BBD_TIPO",BBDTrb->BBD_TIPO),1,6)
            //
            If Len(cTipo) < 8 
               //Motta
               //cTipo := cTipo+Space(8-Len(cTipo)) 
               cTipo := cTipo+Space(6-Len(cTipo)) 
            Endif 
            // Motta
            If Trim(BBDTrb->AAG) == "S"
				cAAG            := "*" 
			Else 
				cAAG            := " " 
			Endif 
			//
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // verifica proxima pagina...                                         
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            If nLi > nQtdLin
               R620Cabec()
            Endif 
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Imprime...                                                         
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            @ ++nLi, nColuna pSay BBDTrb->BBD_NUMATE           +Space(01)+BBDTrb->BBD_NSALA +Space(03)+;
                                   Dtoc(BBDTrb->BBD_DATA)      +Space(01)+BBDTrb->BBD_HORA  +;
                                   Space(02)+BA1->BA1_CONEMP   +Space(01)+BA1->BA1_SUBCON   +Space(01)+;
                                   Substr(BQC->BQC_DESCRI,1,30)+Space(01)+cCodUsu+;
                                   Space(01)+Substr(BBDTrb->BBD_NOME,1,35)+Space(01)+;
                                   Substr(BBDTrb->BBD_TELEFO,1,9) +Space(01)+BTHTrb->BTH_HORINI+Space(01)+;
                                   BTHTrb->BTH_HORFIN+Space(03)   +cTempo   + Space(02)+;
                                   X3combo("BBD_ENCAIX",BBDTrb->BBD_ENCAIX) + Space(01)+cTipo+Space(01)+;
                                   Substr(BBDTrb->BBD_USUOPE,1,13)+Space(01)+ ;
                                   cCodCanc + Space(18-Len(cCodCanc)) + Space(01) + cAAG
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Soma pacientes...                                                  
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸               
            nUsuCre ++
            nTotUsu ++
            If BBDTrb->BBD_ENCAIX == "1"
               nTotEnc ++
            Endif
            If BBDTrb->BBD_TIPO =="1"
               nTotCon ++
            Elseif BBDTrb->BBD_TIPO =="2"
               nTotRev ++
            Elseif BBDTrb->BBD_TIPO =="3"   
               nTotPro ++            
            Endif
            If ! Empty(BBDTrb->BBD_NUMATE)
               nTotAte ++  
            Endif
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Fecha arquivo...                                                   
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            BTHTrb->(DbCloseArea())
            //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
            // Proximo registro...                                                
            //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
            BBDTrb->(DbSkip())
      Enddo
      //旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
      // Imprime Sub-Total...                                               
      //읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
      @ ++nLi, nColuna pSay Replicate("-",nLimite)
      @ ++nLi, nColuna pSay "Total de pacientes: "+Alltrim(Str(nUsuCre))
      nLi++
      nUsuCre := 0
Enddo
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// verifica proxima pagina...                                         
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If nLi > nQtdLin
   R620Cabec()
Endif 
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Imprime Total Geral...                                             
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
@ ++nLi, nColuna pSay "Resumo Geral do Relatorio"
@ ++nLi, nColuna pSay "----------------------------"
@ ++nLi, nColuna pSay "Consultas             : "+Alltrim(Str(nTotCon))
@ ++nLi, nColuna pSay "Encaixes              : "+Alltrim(Str(nTotEnc))
@ ++nLi, nColuna pSay "Revisoes              : "+Alltrim(Str(nTotRev))
@ ++nLi, nColuna pSay "Procedimentos         : "+Alltrim(Str(nTotPro))
@ ++nLi, nColuna pSay "Pacientes Agendados   : "+Alltrim(Str(nTotUsu))
@ ++nLi, nColuna pSay "Pacientes Atendidos   : "+Alltrim(Str(nTotAte))
@ ++nLi, nColuna pSay "Cancelamento de Agenda: "+Alltrim(Str(nTotCac))
@ ++nLi, nColuna pSay "----------------------------"
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Imprime rodape do relatorio...                                     
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
Roda(0,space(10),cTamanho)
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Fecha arquivo...                                                   
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
BBDTrb->(DbCloseArea())
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Libera impressao                                                         
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
If  aReturn[5] == 1
    Set Printer To
    Ourspool(cRel)
End
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Fim do Relat줿io                                                         
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
Return
/*/
複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複複
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
굇旼컴컴컴컴컴쩡컴컴컴컴컴쩡컴컴컴쩡컴컴컴컴컴컴컴컴컴컴컫컴컴컴쩡컴컴컴컴커굇
굇쿛rograma    R620Cabec  Autor  Brunoro               Data  29.01.03 낢
굇쳐컴컴컴컴컴탠컴컴컴컴컴좔컴컴컴좔컴컴컴컴컴컴컴컴컴컴컨컴컴컴좔컴컴컴컴캑굇
굇쿏escricao   Imprime TDE...                                             낢
굇읕컴컴컴컴컴좔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸굇
굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇굇
/*/
Static Function R620Cabec()
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Imprime cabecalho...                                                     
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
nLi := Cabec(cTitulo,cCabec1,cCabec2,cRel,cTamanho,IIF(aReturn[4]==1,GetMv("MV_COMP"),GetMv("MV_NORM")))
//旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
// Fim da Rotina...                                                         
//읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸

Return
